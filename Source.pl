:- use_module(library(clpfd)).

/* Just solve simple sodoku */
sudoku_solver(Rows) :-
    length(Rows, 9),
    maplist(same_length(Rows), Rows),
    append(Rows, Vs), Vs ins 1..9,
    maplist(all_distinct, Rows),
    transpose(Rows, Columns),
    maplist(all_distinct, Columns),
    Rows = [A, B, C, D, E, F, G, H, I],
    
    blocks(A, B, C),
    blocks(D, E, F),
    blocks(G, H, I).

blocks([], [], []).
blocks([A, B, C | T1], [D, E, F | T2], [G, H, I | T3]) :-
    all_distinct([A, B, C, D, E, F ,G ,H ,I]),
    blocks(T1, T2, T3).

/* Solve multiple sodoku */
multiple_sodoku_solver(S0, S1, S2, S3, S4) :-
    
    sudoku_solver(S0),
    sudoku_solver(S1),
    sudoku_solver(S2),
    sudoku_solver(S3),
    sudoku_solver(S4),
    
    problem(0, S0),
    problem(1, S1),
    problem(2, S2),
    problem(3, S3),
    problem(4, S4),
    
    S0 = [ [_, _, _, _, _, _, _  , _  , _ ],
           [_, _, _, _, _, _, _  , _  , _ ],
           [_, _, _, _, _, _, _  , _  , _ ],
           [_, _, _, _, _, _, _  , _  , _ ],
           [_, _, _, _, _, _, _  , _  , _ ],
           [_, _, _, _, _, _, _  , _  , _ ],
           [_, _, _, _, _, _, E01, E02, E03],
           [_, _, _, _, _, _, E04, E05, E06],
           [_, _, _, _, _, _, E07, E08, E09] ],
    
    S1 = [ [_  , _  , _  , _, _, _, _, _, _],
           [_  , _  , _  , _, _, _, _, _, _],
           [_  , _  , _  , _, _, _, _, _, _],
           [_  , _  , _  , _, _, _, _, _, _],
           [_  , _  , _  , _, _, _, _, _, _],
           [_  , _  , _  , _, _, _, _, _, _],
           [E10, E11, E12, _, _, _, _, _, _],
           [E13, E14, E15, _, _, _, _, _, _],
           [E16, E17, E18, _, _, _, _, _, _] ],
    
    S2 = [ [E01, E02, E03, _, _, _, E10, E11, E12],
           [E04, E05, E06, _, _, _, E13, E14, E15],
           [E07, E08, E09, _, _, _, E16, E17, E18],
       [_  , _  , _  , _, _, _, _  , _  , _  ],
           [_  , _  , _  , _, _, _, _  , _  , _  ],
           [_  , _  , _  , _, _, _, _  , _  , _  ],
           [E19, E20, E21, _, _, _, E28, E29, E30],
           [E22, E23, E24, _, _, _, E31, E32, E33],
           [E25, E26, E27, _, _, _, E34, E35, E36] ],
    
    S3 = [ [_, _, _, _, _, _, E19, E20, E21],
           [_, _, _, _, _, _, E22, E23, E24],
           [_, _, _, _, _, _, E25, E26, E27],
           [_, _, _, _, _, _, _  , _  , _  ],
           [_, _, _, _, _, _, _  , _  , _  ],
           [_, _, _, _, _, _, _  , _  , _  ],
           [_, _, _, _, _, _, _  , _  , _  ],
           [_, _, _, _, _, _, _  , _  , _  ],
           [_, _, _, _, _, _, _  , _  , _  ] ],
          
    S4 = [ [E28, E29, E30, _, _, _, _, _, _],
           [E31, E32, E33, _, _, _, _, _, _],
           [E34, E35, E36, _, _, _, _, _, _],
           [_  , _  , _  , _, _, _, _, _, _],
           [_  , _  , _  , _, _, _, _, _, _],
           [_  , _  , _  , _, _, _, _, _, _],
           [_  , _  , _  , _, _, _, _, _, _],
           [_  , _  , _  , _, _, _, _, _, _],
           [_  , _  , _  , _, _, _, _, _, _] ].

/* Test 5 tables for problem */
problem(0, P) :-
        P = [[_,7,_,_,_,_,_,1,_],
             [5,_,_,7,_,4,_,_,2],
             [_,_,_,_,9,_,_,_,_],
             [_,2,_,9,_,6,_,7,_],
             [_,_,1,_,_,_,8,_,_],
             [_,6,_,1,_,8,_,2,_],
             [_,_,_,_,8,_,_,_,_],
             [4,_,_,3,_,5,_,_,1],
             [_,3,_,_,_,_,_,4,_]].

problem(1, P) :-
        P = [[_,9,_,_,_,_,_,8,_],
             [1,_,_,2,_,3,_,_,5],
             [_,_,_,_,5,_,_,_,_],
             [_,1,_,6,_,7,_,2,_],
             [_,_,4,_,_,_,7,_,_],
             [_,6,_,1,_,9,_,3,_],
             [_,_,_,_,9,_,_,_,_],
             [3,_,_,5,_,8,_,_,1],
             [_,5,_,_,_,_,_,7,_]].

problem(2, P) :-
        P = [[_,_,_,_,_,_,_,_,_],
             [_,_,1,4,_,7,3,_,_],
             [_,4,_,_,1,_,_,5,_],
             [_,2,_,9,_,5,_,3,_],
             [_,_,8,_,_,_,2,_,_],
             [_,7,_,1,_,2,_,9,_],
             [_,6,_,_,7,_,_,8,_],
             [_,_,9,3,_,4,7,_,_],
             [_,_,_,_,_,_,_,_,_]].
             
problem(3, P) :-
        P = [[_,1,_,_,_,_,_,6,_],
             [3,_,_,7,_,6,_,_,9],
             [_,_,_,_,3,_,_,_,_],
             [_,9,_,2,_,1,_,8,_],
             [_,_,2,_,_,_,1,_,_],
             [_,5,_,4,_,8,_,3,_],
             [_,_,_,_,4,_,_,_,_],
             [8,_,_,3,_,9,_,_,6],
             [_,4,_,_,_,_,_,7,_]].

problem(4, P) :-
        P = [[_,8,_,_,_,_,_,5,_],
             [7,_,_,9,_,3,_,_,1],
             [_,_,_,_,1,_,_,_,_],
             [_,7,_,6,_,4,_,3,_],
             [_,_,6,_,_,_,8,_,_],
             [_,3,_,8,_,2,_,4,_],
             [_,_,_,_,3,_,_,_,_],
             [2,_,_,4,_,9,_,_,3],
             [_,5,_,_,_,_,_,8,_]].